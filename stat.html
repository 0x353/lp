<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blockchain Betting Info</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.2/ethers.umd.min.js"></script>
    <style>
      body {
    font-family: Arial, sans-serif;
    background-color: #f8f8f8;
    margin: 0;
    padding: 20px;
    text-align: center;
}

header {
    background-color: #2c3e50;
    color: white;
    padding: 15px;
    font-size: 24px;
}

section {
    background: white;
    margin: 20px auto;
    padding: 15px;
    border-radius: 5px;
    width: 90%;
    max-width: 600px;
    box-shadow: 0px 2px 5px rgba(0, 0, 0, 0.2);
}

h2 {
    color: #34495e;
}

p, ul {
    text-align: left;
}

ul {
    list-style: none;
    padding: 0;
}

li {
    background: #ecf0f1;
    padding: 10px;
    margin: 5px 0;
    border-radius: 3px;
}

button {
    background-color: #3498db;
    color: white;
    padding: 10px;
    border: none;
    cursor: pointer;
    margin-top: 10px;
}

button:hover {
    background-color: #2980b9;
}
    </style>
</head>
<body>
    <header>
         <h1>ğŸ“¢ Blockchain Betting Info</h1>

    <section id="winner">
        <h2>ğŸ† Pemenang Terbaru</h2>
        <p><strong>Alamat Pemenang:</strong> <span id="winnerAddress">Loading...</span></p>
        <p><strong>Hadiah yang Dimenangkan:</strong> <span id="winnerAmount">Loading...</span></p>
        <p><strong>Waktu Menang:</strong> <span id="winnerTime">Loading...</span></p>
    </section>

    <section id="bet-history">
        <h2>ğŸ“œ Riwayat Taruhan</h2>
        <p><strong>Total Pemain:</strong> <span id="totalPlayers">Loading...</span></p>
        <p><strong>Total Payout:</strong> <span id="totalPayout">Loading...</span></p>
        <p><strong>Total Taruhan:</strong> <span id="totalBets">Loading...</span></p>
        <button onclick="toggleBetList()">Lihat Daftar Taruhan</button>
        <ul id="betList" style="display: none;"></ul>
    </section>

    <section id="contract-stats">
        <h2>ğŸ” Statistik Kontrak</h2>
        <p><strong>Saldo Kontrak:</strong> <span id="contractBalance">Loading...</span></p>
        <p><strong>Total Pemenang yang Klaim:</strong> <span id="claimedWinners">Loading...</span></p>
        <p><strong>Total Hadiah yang Dibayarkan:</strong> <span id="totalPaid">Loading...</span></p>
        <p><strong>Total Pemain Berpartisipasi:</strong> <span id="totalParticipants">Loading...</span></p>
    </section>

    <section id="notifications">
        <h2>ğŸ“¢ Notifikasi Terbaru</h2>
        <ul id="eventList"></ul>
    </section>

  <script defer src="app.js"></script>

  <script>
    const provider = new ethers.JsonRpcProvider("https://sepolia.base.org");

// âš ï¸ GANTI DENGAN ALAMAT KONTRAK YANG BENAR
const contractAddress = "0x2473fca0ac39EFc6bC2B6262021161AdbF604309";

// âš ï¸ GANTI DENGAN ABI KONTRAK ANDA
const abi = [{"inputs":[],"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"betId","type":"bytes32"},{"indexed":true,"internalType":"address","name":"liker","type":"address"}],"name":"BetLiked","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"player","type":"address"},{"indexed":false,"internalType":"bytes32","name":"betId","type":"bytes32"},{"indexed":false,"internalType":"string","name":"number","type":"string"},{"indexed":false,"internalType":"uint256","name":"betAmount","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"timestamp","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"blockNumber","type":"uint256"},{"indexed":false,"internalType":"bytes32","name":"txHash","type":"bytes32"}],"name":"BetPlaced","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"drawId","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"winningNumber","type":"uint256"}],"name":"BetResultSet","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"bytes32","name":"betId","type":"bytes32"},{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"string","name":"comment","type":"string"},{"indexed":false,"internalType":"uint256","name":"timestamp","type":"uint256"}],"name":"CommentAdded","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"bytes32","name":"betId","type":"bytes32"},{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"commentIndex","type":"uint256"}],"name":"CommentDeleted","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"bytes32","name":"betId","type":"bytes32"},{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"commentIndex","type":"uint256"},{"indexed":false,"internalType":"string","name":"newComment","type":"string"}],"name":"CommentUpdated","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"winner","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"ETHClaimed","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"winner","type":"address"}],"name":"LastWinnerUpdated","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"totalPayout","type":"uint256"}],"name":"TotalPayoutUpdated","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"totalPlayers","type":"uint256"}],"name":"TotalPlayersUpdated","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"bytes32","name":"betId","type":"bytes32"},{"indexed":true,"internalType":"address","name":"winner","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"WinnerSet","type":"event"},{"inputs":[{"internalType":"bytes32","name":"betId","type":"bytes32"},{"internalType":"string","name":"_comment","type":"string"}],"name":"addComment","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"","type":"bytes32"},{"internalType":"uint256","name":"","type":"uint256"}],"name":"betComments","outputs":[{"internalType":"address","name":"commenter","type":"address"},{"internalType":"string","name":"text","type":"string"},{"internalType":"uint256","name":"timestamp","type":"uint256"},{"internalType":"bool","name":"isDeleted","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"betHistory","outputs":[{"internalType":"address","name":"player","type":"address"},{"internalType":"bytes32","name":"betId","type":"bytes32"},{"internalType":"string","name":"number","type":"string"},{"internalType":"uint256","name":"betAmount","type":"uint256"},{"internalType":"uint256","name":"timestamp","type":"uint256"},{"internalType":"uint256","name":"blockNumber","type":"uint256"},{"internalType":"bytes32","name":"txHash","type":"bytes32"},{"internalType":"bool","name":"isETH","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"","type":"bytes32"},{"internalType":"address","name":"","type":"address"}],"name":"betLikes","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"betPrice","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"betResults","outputs":[{"internalType":"uint256","name":"drawId","type":"uint256"},{"internalType":"uint256","name":"winningNumber","type":"uint256"},{"internalType":"bool","name":"isProcessed","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"name":"betWinners","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"name":"bets","outputs":[{"internalType":"address","name":"player","type":"address"},{"internalType":"bytes32","name":"betId","type":"bytes32"},{"internalType":"string","name":"number","type":"string"},{"internalType":"uint256","name":"betAmount","type":"uint256"},{"internalType":"uint256","name":"timestamp","type":"uint256"},{"internalType":"uint256","name":"blockNumber","type":"uint256"},{"internalType":"bytes32","name":"txHash","type":"bytes32"},{"internalType":"bool","name":"isETH","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"claimETH","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"contractBalance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"betId","type":"bytes32"},{"internalType":"uint256","name":"commentIndex","type":"uint256"}],"name":"deleteComment","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"betId","type":"bytes32"},{"internalType":"uint256","name":"commentIndex","type":"uint256"},{"internalType":"string","name":"newComment","type":"string"}],"name":"editComment","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"getAllBets","outputs":[{"components":[{"internalType":"address","name":"player","type":"address"},{"internalType":"bytes32","name":"betId","type":"bytes32"},{"internalType":"string","name":"number","type":"string"},{"internalType":"uint256","name":"betAmount","type":"uint256"},{"internalType":"uint256","name":"timestamp","type":"uint256"},{"internalType":"uint256","name":"blockNumber","type":"uint256"},{"internalType":"bytes32","name":"txHash","type":"bytes32"},{"internalType":"bool","name":"isETH","type":"bool"}],"internalType":"struct BetHistory.Bet[]","name":"","type":"tuple[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"betId","type":"bytes32"}],"name":"getComments","outputs":[{"components":[{"internalType":"address","name":"commenter","type":"address"},{"internalType":"string","name":"text","type":"string"},{"internalType":"uint256","name":"timestamp","type":"uint256"},{"internalType":"bool","name":"isDeleted","type":"bool"}],"internalType":"struct BetHistory.Comment[]","name":"","type":"tuple[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_user","type":"address"}],"name":"getUserBets","outputs":[{"components":[{"internalType":"address","name":"player","type":"address"},{"internalType":"bytes32","name":"betId","type":"bytes32"},{"internalType":"string","name":"number","type":"string"},{"internalType":"uint256","name":"betAmount","type":"uint256"},{"internalType":"uint256","name":"timestamp","type":"uint256"},{"internalType":"uint256","name":"blockNumber","type":"uint256"},{"internalType":"bytes32","name":"txHash","type":"bytes32"},{"internalType":"bool","name":"isETH","type":"bool"}],"internalType":"struct BetHistory.Bet[]","name":"","type":"tuple[]"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"lastWinner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"betId","type":"bytes32"}],"name":"likeBet","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"maxBet","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"minBet","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"string","name":"_number","type":"string"},{"internalType":"uint256","name":"_times","type":"uint256"},{"internalType":"bool","name":"_isETH","type":"bool"}],"name":"placeBet","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_drawId","type":"uint256"},{"internalType":"uint256","name":"_winningNumber","type":"uint256"}],"name":"setBetResult","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_winner","type":"address"},{"internalType":"uint256","name":"_amount","type":"uint256"}],"name":"setWinner","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"totalBetsByPlayer","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalPayout","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"totalPayoutPerDraw","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalPlayers","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"},{"internalType":"uint256","name":"","type":"uint256"}],"name":"userBets","outputs":[{"internalType":"address","name":"player","type":"address"},{"internalType":"bytes32","name":"betId","type":"bytes32"},{"internalType":"string","name":"number","type":"string"},{"internalType":"uint256","name":"betAmount","type":"uint256"},{"internalType":"uint256","name":"timestamp","type":"uint256"},{"internalType":"uint256","name":"blockNumber","type":"uint256"},{"internalType":"bytes32","name":"txHash","type":"bytes32"},{"internalType":"bool","name":"isETH","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"winnings","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_amount","type":"uint256"}],"name":"withdrawETH","outputs":[],"stateMutability":"nonpayable","type":"function"},{"stateMutability":"payable","type":"receive"}];
const contract = new ethers.Contract(contractAddress, abi, provider);

async function loadData() {
    try {
        console.log("ğŸ”„ Memuat data dari blockchain...");
        
        const totalPlayers = await contract.totalPlayers();
        console.log("âœ… Total Pemain:", totalPlayers);
        document.getElementById("totalPlayers").textContent = totalPlayers;

        const totalPayout = await contract.totalPayout();
        console.log("âœ… Total Payout:", ethers.formatEther(totalPayout), "ETH");
        document.getElementById("totalPayout").textContent = ethers.formatEther(totalPayout) + " ETH";

        const totalBets = await contract.totalBets();
        console.log("âœ… Total Taruhan:", totalBets);
        document.getElementById("totalBets").textContent = totalBets;

        const contractBalance = await contract.contractBalance();
        console.log("âœ… Saldo Kontrak:", ethers.formatEther(contractBalance), "ETH");
        document.getElementById("contractBalance").textContent = ethers.formatEther(contractBalance) + " ETH";

        const claimedWinners = await contract.totalClaimedWinners();
        console.log("âœ… Total Pemenang yang Klaim:", claimedWinners);
        document.getElementById("claimedWinners").textContent = claimedWinners;

        const totalPaid = await contract.totalPaid();
        console.log("âœ… Total Hadiah yang Dibayarkan:", ethers.formatEther(totalPaid), "ETH");
        document.getElementById("totalPaid").textContent = ethers.formatEther(totalPaid) + " ETH";

        const totalParticipants = await contract.totalParticipants();
        console.log("âœ… Total Pemain Berpartisipasi:", totalParticipants);
        document.getElementById("totalParticipants").textContent = totalParticipants;

        const lastWinner = await contract.lastWinner();
        console.log("âœ… Alamat Pemenang Terbaru:", lastWinner);
        document.getElementById("winnerAddress").textContent = lastWinner;

        const lastWinnerAmount = await contract.lastWinnerAmount();
        console.log("âœ… Hadiah Pemenang:", ethers.formatEther(lastWinnerAmount), "ETH");
        document.getElementById("winnerAmount").textContent = ethers.formatEther(lastWinnerAmount) + " ETH";

        const lastWinnerTime = await contract.lastWinnerTime();
        console.log("âœ… Waktu Menang:", new Date(lastWinnerTime * 1000).toUTCString());
        document.getElementById("winnerTime").textContent = new Date(lastWinnerTime * 1000).toUTCString();

    } catch (error) {
        console.error("âŒ Gagal memuat data:", error);
        alert("Terjadi kesalahan dalam mengambil data dari smart contract.");
    }
}

function listenEvents() {
    console.log("ğŸ§ Mendengarkan event dari smart contract...");

    contract.on("NewWinner", (winner, amount) => {
        console.log("ğŸ‰ New Winner Event:", winner, ethers.formatEther(amount));
        addNotification(`ğŸ‰ ${winner.slice(0, 6)}... memenangkan ${ethers.formatEther(amount)} ETH!`);
    });

    contract.on("NewBet", (player) => {
        console.log("ğŸ“¢ New Bet Event:", player);
        addNotification(`ğŸ“¢ Taruhan baru oleh ${player.slice(0, 6)}...`);
    });

    contract.on("JackpotIncreased", (amount) => {
        console.log("ğŸ”¥ Jackpot Increased Event:", ethers.formatEther(amount));
        addNotification(`ğŸ”¥ Hadiah pool meningkat menjadi ${ethers.formatEther(amount)} ETH!`);
    });
}

function addNotification(message) {
    const listItem = document.createElement("li");
    listItem.textContent = message;
    document.getElementById("eventList").appendChild(listItem);
}

window.onload = async () => {
    await loadData();
    listenEvents();
};
  </script>
</body>
</html>
