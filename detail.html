<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Bet Detail</title>
  <script src="https://cdn.jsdelivr.net/npm/web3@1.10.0/dist/web3.min.js"></script>
  <style>
    body {
      background-color: #121212;
      color: white;
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    .container {
      background-color: #1e1e1e;
      padding: 20px;
      border-radius: 10px;
    }
    a {
      color: #1a88ff;
      text-decoration: none;
    }
    .comment-section {
      padding: 10px;
      background-color: #2a2a2a;
      border-radius: 5px;
      margin-top: 10px;
    }
    .comment-list {
      max-height: 200px;
      overflow-y: auto;
      margin-bottom: 10px;
    }
    .comment-section textarea {
      width: 100%;
      min-height: 60px;
      background-color: #333;
      color: white;
      border: 1px solid #555;
      border-radius: 5px;
      padding: 5px;
      margin-bottom: 5px;
    }
    .comment-section button {
      transition: background 0.3s;
    }
    .comment-section button:hover {
      background: rgba(0, 255, 0, 0.7);
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Bet Detail</h2>
    <div id="ticketDetail">Loading...</div>
  </div>

  <script>
    const contractAddress = '0xA6074b47915d155B5EB097c446fc9d850A4C6E60';
    const abi = [{"inputs":[],"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"betId","type":"bytes32"},{"indexed":true,"internalType":"address","name":"liker","type":"address"},{"indexed":false,"internalType":"uint256","name":"likeCount","type":"uint256"}],"name":"BetLiked","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"betId","type":"bytes32"},{"indexed":true,"internalType":"address","name":"liker","type":"address"}],"name":"BetLiked","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"betId","type":"bytes32"},{"indexed":true,"internalType":"address","name":"liker","type":"address"},{"indexed":false,"internalType":"uint256","name":"timestamp","type":"uint256"},{"indexed":false,"internalType":"string","name":"likeType","type":"string"}],"name":"BetLiked","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"betId","type":"bytes32"},{"indexed":true,"internalType":"address","name":"liker","type":"address"},{"indexed":false,"internalType":"uint256","name":"timestamp","type":"uint256"},{"indexed":false,"internalType":"string","name":"likeType","type":"string"},{"indexed":false,"internalType":"uint256","name":"newLikeCount","type":"uint256"}],"name":"BetLiked","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"liker","type":"address"},{"indexed":true,"internalType":"bytes32","name":"betId","type":"bytes32"},{"indexed":false,"internalType":"uint256","name":"newLikeCount","type":"uint256"}],"name":"BetLiked","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"player","type":"address"},{"indexed":false,"internalType":"bytes32","name":"betId","type":"bytes32"},{"indexed":false,"internalType":"string","name":"number","type":"string"},{"indexed":false,"internalType":"uint256","name":"betAmount","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"timestamp","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"blockNumber","type":"uint256"},{"indexed":false,"internalType":"bytes32","name":"txHash","type":"bytes32"}],"name":"BetPlaced","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"drawId","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"winningNumber","type":"uint256"}],"name":"BetResultSet","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"betId","type":"bytes32"},{"indexed":true,"internalType":"address","name":"liker","type":"address"},{"indexed":false,"internalType":"uint256","name":"likeCount","type":"uint256"}],"name":"BetUnliked","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"betId","type":"bytes32"},{"indexed":true,"internalType":"address","name":"liker","type":"address"},{"indexed":false,"internalType":"uint256","name":"timestamp","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"newLikeCount","type":"uint256"}],"name":"BetUnliked","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"betId","type":"bytes32"},{"indexed":true,"internalType":"address","name":"winner","type":"address"},{"indexed":false,"internalType":"uint256","name":"winningNumber","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"prize","type":"uint256"}],"name":"BetWon","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"betId","type":"bytes32"},{"indexed":true,"internalType":"address","name":"commenter","type":"address"},{"indexed":false,"internalType":"string","name":"comment","type":"string"},{"indexed":false,"internalType":"uint256","name":"timestamp","type":"uint256"}],"name":"CommentAdded","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"bytes32","name":"betId","type":"bytes32"},{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"commentIndex","type":"uint256"}],"name":"CommentDeleted","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"bytes32","name":"betId","type":"bytes32"},{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"commentIndex","type":"uint256"},{"indexed":false,"internalType":"string","name":"newComment","type":"string"}],"name":"CommentUpdated","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"winner","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"ETHClaimed","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"winner","type":"address"}],"name":"LastWinnerUpdated","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"player","type":"address"},{"indexed":false,"internalType":"uint256","name":"totalPlayers","type":"uint256"}],"name":"PlayerJoined","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"winner","type":"address"},{"indexed":false,"internalType":"uint256","name":"reward","type":"uint256"}],"name":"RewardDistributed","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"bytes32","name":"betId","type":"bytes32"},{"indexed":false,"internalType":"uint256","name":"totalComments","type":"uint256"}],"name":"TotalCommentsUpdated","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"totalPayout","type":"uint256"}],"name":"TotalPayoutUpdated","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"totalPlayers","type":"uint256"}],"name":"TotalPlayersUpdated","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"newTotalPrizes","type":"uint256"}],"name":"TotalPrizesUpdated","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"winner","type":"address"},{"indexed":false,"internalType":"uint256","name":"prize","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"totalWinners","type":"uint256"}],"name":"WinnerAnnounced","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"bytes32","name":"betId","type":"bytes32"},{"indexed":true,"internalType":"address","name":"winner","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"WinnerSet","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"betId","type":"bytes32"},{"indexed":true,"internalType":"address","name":"winner","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"number","type":"uint256"}],"name":"WinnerSet","type":"event"},{"inputs":[{"internalType":"bytes32","name":"betId","type":"bytes32"},{"internalType":"string","name":"_comment","type":"string"}],"name":"addComment","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"","type":"bytes32"},{"internalType":"uint256","name":"","type":"uint256"}],"name":"betComments","outputs":[{"internalType":"address","name":"commenter","type":"address"},{"internalType":"uint256","name":"timestamp","type":"uint256"},{"internalType":"string","name":"commentText","type":"string"},{"internalType":"bool","name":"isDeleted","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"betHistory","outputs":[{"internalType":"address","name":"player","type":"address"},{"internalType":"bytes32","name":"betId","type":"bytes32"},{"internalType":"string","name":"number","type":"string"},{"internalType":"uint256","name":"betAmount","type":"uint256"},{"internalType":"uint256","name":"timestamp","type":"uint256"},{"internalType":"uint256","name":"blockNumber","type":"uint256"},{"internalType":"bytes32","name":"txHash","type":"bytes32"},{"internalType":"bool","name":"isETH","type":"bool"},{"internalType":"uint256","name":"likeCount","type":"uint256"},{"internalType":"uint256","name":"commentCount","type":"uint256"},{"internalType":"uint256","name":"payoutAmount","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"name":"betLikeCount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"","type":"bytes32"},{"internalType":"uint256","name":"","type":"uint256"}],"name":"betLikeDetails","outputs":[{"internalType":"address","name":"liker","type":"address"},{"internalType":"uint256","name":"timestamp","type":"uint256"},{"internalType":"string","name":"likeType","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"","type":"bytes32"},{"internalType":"uint256","name":"","type":"uint256"}],"name":"betLikeList","outputs":[{"internalType":"address","name":"liker","type":"address"},{"internalType":"uint256","name":"timestamp","type":"uint256"},{"internalType":"string","name":"likeType","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"","type":"bytes32"},{"internalType":"uint256","name":"","type":"uint256"}],"name":"betLikers","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"","type":"bytes32"},{"internalType":"address","name":"","type":"address"}],"name":"betLikes","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"","type":"bytes32"},{"internalType":"uint256","name":"","type":"uint256"}],"name":"betLikesArray","outputs":[{"internalType":"address","name":"liker","type":"address"},{"internalType":"uint256","name":"timestamp","type":"uint256"},{"internalType":"string","name":"likeType","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"betPrice","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"betResults","outputs":[{"internalType":"uint256","name":"drawId","type":"uint256"},{"internalType":"uint256","name":"winningNumber","type":"uint256"},{"internalType":"bool","name":"isProcessed","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"name":"betToDrawId","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"name":"betWinners","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"name":"bets","outputs":[{"internalType":"address","name":"player","type":"address"},{"internalType":"bytes32","name":"betId","type":"bytes32"},{"internalType":"string","name":"number","type":"string"},{"internalType":"uint256","name":"betAmount","type":"uint256"},{"internalType":"uint256","name":"timestamp","type":"uint256"},{"internalType":"uint256","name":"blockNumber","type":"uint256"},{"internalType":"bytes32","name":"txHash","type":"bytes32"},{"internalType":"bool","name":"isETH","type":"bool"},{"internalType":"uint256","name":"likeCount","type":"uint256"},{"internalType":"uint256","name":"commentCount","type":"uint256"},{"internalType":"uint256","name":"payoutAmount","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"claimETH","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"name":"commentCount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"contractBalance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"betId","type":"bytes32"},{"internalType":"uint256","name":"commentIndex","type":"uint256"}],"name":"deleteComment","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"distributeReward","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"betId","type":"bytes32"},{"internalType":"uint256","name":"commentIndex","type":"uint256"},{"internalType":"string","name":"newComment","type":"string"}],"name":"editComment","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"getAllBets","outputs":[{"components":[{"internalType":"address","name":"player","type":"address"},{"internalType":"bytes32","name":"betId","type":"bytes32"},{"internalType":"string","name":"number","type":"string"},{"internalType":"uint256","name":"betAmount","type":"uint256"},{"internalType":"uint256","name":"timestamp","type":"uint256"},{"internalType":"uint256","name":"blockNumber","type":"uint256"},{"internalType":"bytes32","name":"txHash","type":"bytes32"},{"internalType":"bool","name":"isETH","type":"bool"},{"internalType":"uint256","name":"likeCount","type":"uint256"},{"internalType":"uint256","name":"commentCount","type":"uint256"},{"internalType":"uint256","name":"payoutAmount","type":"uint256"}],"internalType":"struct BetHistory.Bet[]","name":"","type":"tuple[]"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getAllPlayers","outputs":[{"internalType":"address[]","name":"","type":"address[]"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getAllWinners","outputs":[{"internalType":"address[]","name":"","type":"address[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"betId","type":"bytes32"}],"name":"getBetLikers","outputs":[{"internalType":"address[]","name":"","type":"address[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"betId","type":"bytes32"}],"name":"getComments","outputs":[{"components":[{"internalType":"address","name":"commenter","type":"address"},{"internalType":"string","name":"text","type":"string"},{"internalType":"uint256","name":"timestamp","type":"uint256"},{"internalType":"bool","name":"isDeleted","type":"bool"}],"internalType":"struct BetHistory.CommentData[]","name":"","type":"tuple[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"betId","type":"bytes32"}],"name":"getLikeCount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_player","type":"address"}],"name":"getPlayerStats","outputs":[{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"topN","type":"uint256"}],"name":"getTopPlayers","outputs":[{"internalType":"address[]","name":"","type":"address[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_user","type":"address"}],"name":"getUserBets","outputs":[{"components":[{"internalType":"address","name":"player","type":"address"},{"internalType":"bytes32","name":"betId","type":"bytes32"},{"internalType":"string","name":"number","type":"string"},{"internalType":"uint256","name":"betAmount","type":"uint256"},{"internalType":"uint256","name":"timestamp","type":"uint256"},{"internalType":"uint256","name":"blockNumber","type":"uint256"},{"internalType":"bytes32","name":"txHash","type":"bytes32"},{"internalType":"bool","name":"isETH","type":"bool"},{"internalType":"uint256","name":"likeCount","type":"uint256"},{"internalType":"uint256","name":"commentCount","type":"uint256"},{"internalType":"uint256","name":"payoutAmount","type":"uint256"}],"internalType":"struct BetHistory.Bet[]","name":"","type":"tuple[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_betId","type":"uint256"}],"name":"getWinnerByBetId","outputs":[{"components":[{"internalType":"address","name":"winner","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"},{"internalType":"uint256","name":"number","type":"uint256"},{"internalType":"uint256","name":"timestamp","type":"uint256"},{"internalType":"uint256","name":"prizesETH","type":"uint256"}],"internalType":"struct BetHistory.WinnerData","name":"","type":"tuple"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"","type":"bytes32"},{"internalType":"address","name":"","type":"address"}],"name":"hasLiked","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"betId","type":"bytes32"},{"internalType":"address","name":"user","type":"address"}],"name":"hasUserLiked","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"lastLeaderboardReset","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"lastWinner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"betId","type":"bytes32"},{"internalType":"string","name":"likeType","type":"string"}],"name":"likeBet","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"maxBet","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"minBet","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"string","name":"_number","type":"string"},{"internalType":"uint256","name":"_times","type":"uint256"},{"internalType":"bool","name":"_isETH","type":"bool"},{"internalType":"uint256","name":"_payoutAmount","type":"uint256"}],"name":"placeBet","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"playerBets","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"playerStats","outputs":[{"internalType":"uint256","name":"totalBets","type":"uint256"},{"internalType":"uint256","name":"totalAmountBet","type":"uint256"},{"internalType":"uint256","name":"totalWins","type":"uint256"},{"internalType":"uint256","name":"totalPayout","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"playerWins","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"players","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"rewardAmount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_drawId","type":"uint256"},{"internalType":"uint256","name":"_winningNumber","type":"uint256"}],"name":"setBetResult","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_winner","type":"address"},{"internalType":"uint256","name":"_amount","type":"uint256"},{"internalType":"uint256","name":"_betId","type":"uint256"},{"internalType":"uint256","name":"_number","type":"uint256"}],"name":"setWinner","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"topBettor","outputs":[{"internalType":"address","name":"player","type":"address"},{"internalType":"uint256","name":"totalBets","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"totalBetsByPlayer","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"name":"totalComments","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"name":"totalLikes","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalPayout","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"totalPayoutPerDraw","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalPlayers","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalWinners","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"betId","type":"bytes32"}],"name":"unlikeBet","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"},{"internalType":"uint256","name":"","type":"uint256"}],"name":"userBets","outputs":[{"internalType":"address","name":"player","type":"address"},{"internalType":"bytes32","name":"betId","type":"bytes32"},{"internalType":"string","name":"number","type":"string"},{"internalType":"uint256","name":"betAmount","type":"uint256"},{"internalType":"uint256","name":"timestamp","type":"uint256"},{"internalType":"uint256","name":"blockNumber","type":"uint256"},{"internalType":"bytes32","name":"txHash","type":"bytes32"},{"internalType":"bool","name":"isETH","type":"bool"},{"internalType":"uint256","name":"likeCount","type":"uint256"},{"internalType":"uint256","name":"commentCount","type":"uint256"},{"internalType":"uint256","name":"payoutAmount","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"winnerHistory","outputs":[{"internalType":"address","name":"winner","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"},{"internalType":"uint256","name":"number","type":"uint256"},{"internalType":"uint256","name":"timestamp","type":"uint256"},{"internalType":"uint256","name":"prizesETH","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"winnings","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_amount","type":"uint256"}],"name":"withdrawETH","outputs":[],"stateMutability":"nonpayable","type":"function"},{"stateMutability":"payable","type":"receive"}]; // Anda isi sendiri ABI di sini
    let web3;
    let contract;

    // Fungsi untuk mengonversi string ke bytes32
    function toBytes32(str) {
      return web3.utils.padRight(web3.utils.asciiToHex(str), 64);
    }

    // Like Function
    async function toggleLike(betId) {
      try {
        if (typeof window.ethereum === "undefined") {
          alert("MetaMask not found! Please install MetaMask.");
          return;
        }

        const accounts = await window.ethereum.request({ method: "eth_requestAccounts" });
        if (!accounts || accounts.length === 0) {
          alert("Please connect your MetaMask wallet.");
          return;
        }

        const userAccount = accounts[0];
        const betIdBytes32 = toBytes32(betId);
        const liked = await contract.methods.hasUserLiked(betIdBytes32, userAccount).call();
        const button = document.getElementById(`likeButton-${betId}`);
        const statusElement = document.getElementById(`likeStatus-${betId}`);

        statusElement.innerText = "Transaction in progress...";

        let estimatedGas;
        if (liked) {
          estimatedGas = await contract.methods.unlikeBet(betIdBytes32).estimateGas({ from: userAccount });
        } else {
          estimatedGas = await contract.methods.likeBet(betIdBytes32, "👍").estimateGas({ from: userAccount });
        }

        const gasOptions = {
          from: userAccount,
          gas: estimatedGas + 50000,
          maxFeePerGas: web3.utils.toWei("0.0002", "gwei"),
          maxPriorityFeePerGas: web3.utils.toWei("0.00018", "gwei")
        };

        if (liked) {
          await contract.methods.unlikeBet(betIdBytes32).send(gasOptions)
            .on("transactionHash", function (hash) {
              console.log("Transaction sent! Hash:", hash);
            })
            .on("receipt", function (receipt) {
              console.log("Transaction confirmed:", receipt);
              button.style.backgroundColor = "#000000";
              statusElement.innerText = "Disliked successfully";
              button.innerHTML = `<img src="img/like.svg" alt="Dislike" style="width: 11px; height: 11px; vertical-align: middle;">`;
              setTimeout(() => statusElement.innerText = "", 3000);
              updateLikeStatus(betId);
            })
            .on("error", function (error) {
              console.error("Error processing unlike:", error);
              statusElement.innerText = "Dislike failed";
              setTimeout(() => statusElement.innerText = "", 3000);
            });
        } else {
          await contract.methods.likeBet(betIdBytes32, "👍").send(gasOptions)
            .on("transactionHash", function (hash) {
              console.log("Transaction sent! Hash:", hash);
            })
            .on("receipt", function (receipt) {
              console.log("Transaction confirmed:", receipt);
              button.style.backgroundColor = "#ff1a1e";
              statusElement.innerText = "Liked successfully";
              button.innerHTML = `<img src="img/dis.svg" alt="Dislike" style="width: 12px; height: 12px; vertical-align: middle;">`;
              setTimeout(() => statusElement.innerText = "", 3000);
              updateLikeStatus(betId);
            })
            .on("error", function (error) {
              console.error("Error processing like:", error);
              statusElement.innerText = "Like failed";
              setTimeout(() => statusElement.innerText = "", 3000);
            });
        }
      } catch (error) {
        console.error("Failed to toggle like:", error);
      }
    }

    // Fungsi untuk memperbarui jumlah like
    async function updateLikeStatus(betId) {
      try {
        const betIdBytes32 = toBytes32(betId);
        const likeCount = await contract.methods.getLikeCount(betIdBytes32).call();
        document.getElementById(`likeCount-${betId}`).innerText = likeCount;

        const accounts = await window.ethereum.request({ method: "eth_accounts" });
        if (accounts.length === 0) return;

        const userAccount = accounts[0];
        const liked = await contract.methods.hasUserLiked(betIdBytes32, userAccount).call();
        const button = document.getElementById(`likeButton-${betId}`);

        if (liked) {
          button.innerHTML = `<img src="img/dis.svg" alt="Dislike" style="width: 12px; height: 12px; vertical-align: middle;">`;
          button.style.backgroundColor = "#ff1a1e";
        } else {
          button.innerHTML = `<img src="img/like.svg" alt="Like" style="width: 11px; height: 11px; vertical-align: middle;">`;
          button.style.backgroundColor = "#000000";
        }
      } catch (error) {
        console.error("Failed to update like status:", error);
      }
    }

    // Fungsi Lazy Load Komentar
    async function loadComments(betId, limit = 10) {
      try {
        const betIdBytes32 = toBytes32(betId);
        const comments = await contract.methods.getComments(betIdBytes32).call();
        const currentUser = window.ethereum.selectedAddress ? window.ethereum.selectedAddress.toLowerCase() : null;
        let commentHtml = "";

        comments.slice(0, limit).forEach((comment, index) => {
          if (!comment.isDeleted) {
            let date = new Date(comment.timestamp * 1000).toLocaleString();
            let shortCommenter = comment.commenter.slice(0, 6) + "..." + comment.commenter.slice(-4);
            let deleteButton = "";
            let editButton = "";

            if (currentUser && currentUser === comment.commenter.toLowerCase()) {
              deleteButton = `<button onclick="deleteComment('${betId}', ${index})" style="background: rgba(255, 0, 0, 0.5); color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer;">Delete</button>`;
              editButton = `<button id="editBtn-${betId}-${index}" onclick="enableEdit('${betId}', ${index})" style="background: rgba(0, 162, 255, 0.5); color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer;">Edit</button>`;
            }

            commentHtml += `
              <div style="background: #222; padding: 10px; border-radius: 8px; margin-bottom: 10px; border: 1px solid #444; box-shadow: 0 4px 8px rgba(0, 162, 255, 0.2);">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                  <strong style="color: #ad5cff; font-size: 12px;">${shortCommenter}</strong>
                  <span style="color: gray; font-size: 9px; white-space: nowrap;">(${date})</span>
                </div>
                <p id="commentText-${betId}-${index}" style="margin: 5px 0;">${comment.text}</p>
                <br><br>
                ${deleteButton} ${editButton}
              </div>`;
          }
        });

        if (comments.length > limit) {
          commentHtml += `<button onclick="loadComments('${betId}', ${limit + 10})" style="background-color: rgba(0, 123, 255, 0.5);">See more</button>`;
        }

        document.getElementById(`commentList-${betId}`).innerHTML = commentHtml;
        updateCommentCount(betId);
      } catch (error) {
        console.error("Failed to load comments:", error);
      }
    }

    // Fungsi untuk menambahkan atau menyimpan komentar (mode normal dan edit)
    async function addOrUpdateComment(betId) {
      let commentInput = document.getElementById(`commentInput-${betId}`);
      let saveMode = commentInput.dataset.editing === "true";
      let commentIndex = commentInput.dataset.index;

      if (!commentInput.value.trim()) {
        alert("Comments cannot be empty!");
        return;
      }

      try {
        if (typeof window.ethereum === "undefined") {
          alert("MetaMask not detected! Please install MetaMask.");
          return;
        }

        const accounts = await window.ethereum.request({ method: "eth_accounts" });
        if (!accounts || accounts.length === 0) {
          alert("MetaMask is not connected. Please open MetaMask and select an account.");
          return;
        }

        const walletAddress = accounts[0];
        const betIdBytes32 = toBytes32(betId);

        let gasEstimate;
        if (saveMode) {
          gasEstimate = await contract.methods
            .editComment(betIdBytes32, commentIndex, commentInput.value)
            .estimateGas({ from: walletAddress });
        } else {
          gasEstimate = await contract.methods
            .addComment(betIdBytes32, commentInput.value)
            .estimateGas({ from: walletAddress });
        }

        const gasOptions = {
          from: walletAddress,
          gas: gasEstimate + 56000,
          maxFeePerGas: web3.utils.toWei("0.00025", "gwei"),
          maxPriorityFeePerGas: web3.utils.toWei("0.00023", "gwei"),
        };

        if (saveMode) {
          await contract.methods
            .editComment(betIdBytes32, commentIndex, commentInput.value)
            .send(gasOptions);
          disableEdit(betId);
        } else {
          await contract.methods
            .addComment(betIdBytes32, commentInput.value)
            .send(gasOptions);
        }

        commentInput.value = "";
        document.getElementById(`sendBtn-${betId}`).innerText = "Send";
        await loadComments(betId);
      } catch (error) {
        console.error("Failed to save comment:", error);
        alert("Failed to save comment. Please try again later!");
      }
    }

    // Fungsi untuk mengaktifkan mode edit
    function enableEdit(betId, index) {
      let commentTextElement = document.getElementById(`commentText-${betId}-${index}`);
      let commentInput = document.getElementById(`commentInput-${betId}`);
      let sendButton = document.getElementById(`sendBtn-${betId}`);
      let cancelButton = document.getElementById(`cancelBtn-${betId}`);

      commentInput.value = commentTextElement.innerText;
      commentInput.dataset.editing = "true";
      commentInput.dataset.index = index;

      sendButton.innerText = "Save";

      if (!cancelButton) {
        cancelButton = document.createElement("button");
        cancelButton.id = `cancelBtn-${betId}`;
        cancelButton.innerText = "Cancel";
        cancelButton.style.marginLeft = "5px";
        cancelButton.style.background = "rgba(255, 0, 0, 0.5)";
        cancelButton.style.color = "white";
        cancelButton.style.border = "none";
        cancelButton.style.padding = "5px 10px";
        cancelButton.style.borderRadius = "5px";
        cancelButton.style.cursor = "pointer";
        cancelButton.onclick = function () {
          disableEdit(betId);
        };
        sendButton.parentNode.insertBefore(cancelButton, sendButton.nextSibling);
      }
    }

    // Fungsi untuk membatalkan mode edit
    function disableEdit(betId) {
      let commentInput = document.getElementById(`commentInput-${betId}`);
      let sendButton = document.getElementById(`sendBtn-${betId}`);
      let cancelButton = document.getElementById(`cancelBtn-${betId}`);

      commentInput.value = "";
      delete commentInput.dataset.editing;
      delete commentInput.dataset.index;

      sendButton.innerText = "Send";

      if (cancelButton) {
        cancelButton.remove();
      }
    }

    // Fungsi untuk menghapus komentar
    async function deleteComment(betId, index) {
      if (!confirm("Are you sure you want to delete this comment?")) return;

      try {
        const betIdBytes32 = toBytes32(betId);
        const gasEstimate = await contract.methods.deleteComment(betIdBytes32, index).estimateGas({ from: window.ethereum.selectedAddress });
        console.log(`Gas Estimate: ${gasEstimate}`);

        const gasOptions = {
          from: window.ethereum.selectedAddress,
          gas: gasEstimate + 100000,
          maxFeePerGas: web3.utils.toWei("0.0025", "gwei"),
          maxPriorityFeePerGas: web3.utils.toWei("0.0023", "gwei")
        };

        const transaction = await contract.methods.deleteComment(betIdBytes32, index).send(gasOptions);
        console.log(`Transaction Hash: ${transaction.transactionHash}`);

        await loadComments(betId);
      } catch (error) {
        console.error("Failed to delete comment:", error);
        alert("Failed to delete comment. Try again!");
      }
    }

    // Fungsi untuk memperbarui jumlah komentar
    async function updateCommentCount(betId) {
      try {
        const betIdBytes32 = toBytes32(betId);
        const comments = await contract.methods.getComments(betIdBytes32).call();
        const count = comments.filter(c => !c.isDeleted).length;
        document.getElementById(`commentCount-${betId}`).innerText = count;
      } catch (error) {
        console.error(`Failed to fetch comment count for ${betId}:`, error);
      }
    }

    // Fungsi untuk mendengarkan event real-time
    function listenToEvents(betId) {
      const betIdBytes32 = toBytes32(betId);

      contract.events.BetLiked({ filter: { betId: betIdBytes32 } })
        .on('data', () => {
          console.log("BetLiked event detected, updating like count...");
          updateLikeStatus(betId);
        })
        .on('error', err => console.error("Error on BetLiked event:", err));

      contract.events.BetUnliked({ filter: { betId: betIdBytes32 } })
        .on('data', () => {
          console.log("BetUnliked event detected, updating like count...");
          updateLikeStatus(betId);
        })
        .on('error', err => console.error("Error on BetUnliked event:", err));

      contract.events.CommentAdded({ filter: { betId: betIdBytes32 } })
        .on('data', () => {
          console.log("CommentAdded event detected, updating comments...");
          loadComments(betId);
        })
        .on('error', err => console.error("Error on CommentAdded event:", err));

      contract.events.CommentDeleted({ filter: { betId: betIdBytes32 } })
        .on('data', () => {
          console.log("CommentDeleted event detected, updating comments...");
          loadComments(betId);
        })
        .on('error', err => console.error("Error on CommentDeleted event:", err));

      contract.events.CommentUpdated({ filter: { betId: betIdBytes32 } })
        .on('data', () => {
          console.log("CommentUpdated event detected, updating comments...");
          loadComments(betId);
        })
        .on('error', err => console.error("Error on CommentUpdated event:", err));
    }

    async function loadBetDetail() {
      const detailDiv = document.getElementById("ticketDetail");

      if (typeof window.ethereum === 'undefined') {
        detailDiv.innerHTML = 'MetaMask or Web3 provider not found. Please install <a href="https://metamask.io" target="_blank">MetaMask</a>.';
        return;
      }

      try {
        web3 = new Web3(window.ethereum);
        await window.ethereum.enable();
        contract = new web3.eth.Contract(abi, contractAddress);

        const chainId = await web3.eth.getChainId();
        if (chainId !== 84532) {
          detailDiv.innerText = "Please switch to Base Sepolia Testnet in MetaMask.";
          return;
        }

        console.log("ABI:", abi);
        if (!abi || !Array.isArray(abi)) {
          detailDiv.innerText = "Error: ABI is not defined or invalid. Check the abi variable.";
          return;
        }

        const urlParams = new URLSearchParams(window.location.search);
        const betIdParam = urlParams.get('betId');

        console.log("Bet ID dari URL:", betIdParam);
        if (!betIdParam) {
          detailDiv.innerText = "Invalid Bet ID in URL.";
          return;
        }

        const allBets = await contract.methods.getAllBets().call();
        console.log("Data allBets:", allBets);

        if (!allBets || allBets.length === 0) {
          detailDiv.innerText = "No bets found in the contract.";
          return;
        }

        const bet = allBets.find(b => b.betId === betIdParam);
        if (!bet) {
          detailDiv.innerText = "Bet not found.";
          return;
        }

        const shortPlayer = bet.player.slice(0, 10) + "..." + bet.player.slice(-10);
        const shortTxHash = bet.txHash.slice(0, 10) + "..." + bet.txHash.slice(-10);

        detailDiv.innerHTML = `
          <p>Player: <span style="color:#ad5cff;">${shortPlayer}</span></p>
          <p>BetID: <span style="color:#b37500;">${bet.betId}</span></p>
          <p>BetNumber: <span style="color:#00FF66;">${bet.number}</span></p>
          <p>BetAmount: <span style="color:#00FF66;">${bet.betAmount}</span></p>
          <p>Is ETH: <span style="color:${bet.isETH ? '#00FF66' : '#fe6666'};">${bet.isETH ? 'Yes' : 'No'}</span></p>
          <p>Tx: <span style="color:#fe6666;">${shortTxHash}</span></p>
          <p>Block: <a href="https://sepolia.basescan.org/block/${bet.blockNumber}" target="_blank">${bet.blockNumber}</a></p>
          <p>Time: <span style="color:orange;">${new Date(Number(bet.timestamp) * 1000).toISOString()} UTC</span></p>
          <button id="likeButton-${bet.betId}" onclick="toggleLike('${bet.betId}')" 
            style="background-color: #000000; color: white; border: none; padding: 5px 10px; cursor: pointer; margin-top: 5px;">
            <img src="img/like.svg" alt="Like" style="width: 11px; height: 11px; vertical-align: middle;">
          </button>
          <span id="likeCount-${bet.betId}" 
            style="margin-left: 10px; color: #00cc51; font-size: 15px; font-weight: bold;">0</span> Likes
          <p id="likeStatus-${bet.betId}" style="font-size: 12px; color: gray; margin-top: 3px;"></p>
          <details class="comment-dropdown">
            <summary style="display: flex; align-items: center; cursor: pointer; justify-content: space-between; width: 100%; padding: 0 15px;">
              <span style="display: flex; align-items: center; gap: 10px;">
                <img src="img/comment.svg" alt="Komentar" style="width: 18px; height: 18px;" margin-right: 20px;">
                <span id="commentCount-${bet.betId}" style="color: #00cc51; font-size: 15px; font-weight: bold;">0</span> Comments
              </span>
              <img src="img/clos.svg" style="width: 18px; height: 18px; margin-right: 20px;">
            </summary>
            <div id="commentSection-${bet.betId}" class="comment-section">
              <div id="commentList-${bet.betId}" class="comment-list"></div>
              <textarea id="commentInput-${betId}" placeholder="Write a comment..."></textarea>
              <button id="sendBtn-${betId}" onclick="addOrUpdateComment('${bet.betId}')" 
                style="background: rgba(0, 255, 0, 0.5); color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer;">
                Send
              </button>
              <br>
              <h6 style="color: #ff1a1d; text-align: left; padding: 10px; background: url('img/warning.svg') no-repeat left center; background-size: 20px; padding-left: 40px;">
                WARNING: Comments stored on the blockchain are permanent and cannot be deleted. Please be wise in your comments before posting!
              </h6>
            </div>
          </details>
        `;

        await updateLikeStatus(bet.betId);
        await loadComments(bet.betId);
        listenToEvents(bet.betId);
      } catch (err) {
        console.error("Error saat memuat bet:", err);
        detailDiv.innerText = `Failed to load bet detail: ${err.message}`;
      }
    }

    window.onload = loadBetDetail;
  </script>
</body>
</html>
